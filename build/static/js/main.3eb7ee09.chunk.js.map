{"version":3,"sources":["resources/cursor_PNG99.png","drumSynth.ts","Scheduler/Scheduler.ts","Scheduler/getNewScheduledNotes.ts","Scheduler/windowPosition.ts","App.tsx","users/LoginButton.tsx","config.ts","index.tsx"],"names":["module","exports","kick","audioContext","start","osc","createOscillator","osc2","gainOsc","createGain","gainOsc2","type","gain","setValueAtTime","exponentialRampToValueAtTime","frequency","connect","destination","stop","snare","osc3","gainOsc3","filterGain","value","node","createBufferSource","buffer","createBuffer","sampleRate","data","getChannelData","filter","createBiquadFilter","linearRampToValueAtTime","i","Math","random","loop","hihat","gainOsc4","bandpass","highpass","forEach","ratio","osc4","Scheduler","ac","timer","prevHorizon","emitter","EventEmitter","loopLength","this","setInterval","iterate","notes","emit","callback","on","acTime","lookAhead","win","min","max","rawPropWindow","translation","propWindow","schedule","map","note","pos","loopTime","windowPosition","audioContextTime","Boolean","horizon","getNewScheduledNotes","currentTime","length","emitSchedule","serverURL","App","props","scheduler","user","floor","multiLane","React","createRef","subLoops","client","MessageClient","mousePosition","x","y","state","otherMouse","onSchedule","fn","onMessage","message","handleServerMessage","onConnected","reportMousePosition","resume","AudioContext","setAudioContext","suspend","instr","broadcast","diff","getDiff","add","n","send","content","sequence","action","instrument","delete","setLoop","concat","setState","change","newLoopTimes","orig","copy","slice","push","includes","applyDiff","current","setNotes","event","clientX","clientY","className","onMouseMove","handleMouseMove","userInfo","name","id","ref","onChange","handleNoteChange","onClick","startAudio","stopAudio","src","Cursor","alt","style","opacity","position","left","top","height","width","Component","prev","curr","FacebookLoginButton","appId","autoLoad","fields","cssClass","ReactDOM","render","info","document","getElementById"],"mappings":"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","file":"static/js/main.3eb7ee09.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/cursor_PNG99.be56600f.png\";","\nexport function kick(audioContext: AudioContext, start: number) {\n\n    var osc = audioContext.createOscillator();\n    var osc2 = audioContext.createOscillator();\n    var gainOsc = audioContext.createGain();\n    var gainOsc2 = audioContext.createGain();\n\n    osc.type = \"triangle\";\n    osc2.type = \"sine\";\n\n    gainOsc.gain.setValueAtTime(1, start);\n    gainOsc.gain.exponentialRampToValueAtTime(0.001, start + 0.5);\n    \n\n    gainOsc2.gain.setValueAtTime(1, start);\n    gainOsc2.gain.exponentialRampToValueAtTime(0.001, start + 0.5);\n  \n\n    osc.frequency.setValueAtTime(120, start);\n    osc.frequency.exponentialRampToValueAtTime(0.001, start + 0.5);\n\n    osc2.frequency.setValueAtTime(50, start);\n    osc2.frequency.exponentialRampToValueAtTime(0.001, start + 0.5);\n\n    osc.connect(gainOsc);\n    osc2.connect(gainOsc2);\n    gainOsc2.connect(audioContext.destination);\n    gainOsc.connect(audioContext.destination);\n    gainOsc.connect(audioContext.destination);\n    gainOsc2.connect(audioContext.destination);\n\n    osc.start(start);\n    osc2.start(start);\n\n    osc.stop(start + 0.5);\n    osc2.stop(start + 0.5);\n\n};\n\nexport function snare(audioContext: AudioContext, start: number) {\n\n    var osc3 = audioContext.createOscillator();\n    var gainOsc3 = audioContext.createGain();\n\n    var filterGain = audioContext.createGain();\n\n    filterGain.gain.setValueAtTime(1, start);\n    filterGain.gain.exponentialRampToValueAtTime(0.01, start + 0.2);\n\n    osc3.type = \"triangle\";\n    osc3.frequency.value = 100;\n    gainOsc3.gain.value = 0;\n\n    gainOsc3.gain.setValueAtTime(0, start);\n    gainOsc3.gain.exponentialRampToValueAtTime(0.01, start + 0.1);\n\n    osc3.connect(gainOsc3);\n    gainOsc3.connect(audioContext.destination);\n\n    osc3.start(start);\n    osc3.stop(start + 0.2);\n\n    var node = audioContext.createBufferSource(),\n        buffer = audioContext.createBuffer(1, 4096, audioContext.sampleRate),\n        data = buffer.getChannelData(0);\n\n    var filter = audioContext.createBiquadFilter();\n    filter.type = \"highpass\";\n    filter.frequency.setValueAtTime(100, start);\n    filter.frequency.linearRampToValueAtTime(1000, start + 0.2);\n\n\n    for (var i = 0; i < 4096; i++) {\n        data[i] = Math.random();\n    }\n    node.buffer = buffer;\n    node.loop = true;\n    node.connect(filter);\n    filter.connect(filterGain);\n    filterGain.connect(audioContext.destination);\n    node.start(start);\n    node.stop(start + 0.2);\n\n};\n\n\nexport function hihat(audioContext: AudioContext, start: number) {\n\n    var gainOsc4 = audioContext.createGain();\n    var fundamental = 40;\n    var ratios = [2, 3, 4.16, 5.43, 6.79, 8.21];\n\n    var bandpass = audioContext.createBiquadFilter();\n    bandpass.type = \"bandpass\";\n    bandpass.frequency.value = 10000;\n\n    var highpass = audioContext.createBiquadFilter();\n    highpass.type = \"highpass\";\n    highpass.frequency.value = 7000;\n\n\n    ratios.forEach(function(ratio) {\n\n        var osc4 = audioContext.createOscillator();\n        osc4.type = \"square\";\n        osc4.frequency.value = fundamental * ratio;\n        osc4.connect(bandpass);\n\n        osc4.start(start);\n        osc4.stop(start + 0.05);\n        \n    });\n\n    gainOsc4.gain.setValueAtTime(1, start);\n    gainOsc4.gain.exponentialRampToValueAtTime(0.01, start + 0.05);\n    \n    bandpass.connect(highpass);\n    highpass.connect(gainOsc4);\n    gainOsc4.connect(audioContext.destination);\n};","import { EventEmitter } from 'events';\nimport { getNewScheduledNotes } from './getNewScheduledNotes';\n\nconst lookahead = 0.1;\nconst timerInterval = 25;\n\nexport type Seconds = number;\nexport type PropTime = number; // proportional time (0 - 1)\n\nexport interface ILoopNote<T = number> {\n\tdata: T;\n\tloopTime: PropTime;\n}\n\nexport interface IScheduledNote<T = number> {\n\tdata: T;\n\taudioContextTime: Seconds;\n}\n\nexport class Scheduler<T> {\n\tac!: AudioContext;\n\ttimer!: NodeJS.Timer;\n\n\tloop: ILoopNote<T>[] = [];\n\tprevHorizon = 0; // how far we looked ahead on the last iteration\n\n\temitter = new EventEmitter();\n\tloopLength = 2; // seconds\n\n\tsetAudioContext(ac: AudioContext) {\n\t\tthis.ac = ac;\n\t}\n\n\tsetLoop(loop: ILoopNote<T>[]) {\n\t\tthis.loop = loop;\n\t}\n\n\tstart() {\n\t\tif (!this.timer) {\n\t\t\tthis.timer = setInterval(() => this.iterate(), timerInterval);\n\t\t}\n\t}\n\n\temitSchedule(notes: IScheduledNote<T>[]) {\n\t\tthis.emitter.emit('schedule', notes);\n\t}\n\n\tonSchedule(callback: (notes: IScheduledNote<T>[]) => void) {\n\t\tthis.emitter.on('schedule', callback);\n\t}\n\n\titerate() {\n        const {schedule, horizon} = getNewScheduledNotes(\n            this.loop,\n            this.ac.currentTime,\n            lookahead,\n\t\t\tthis.prevHorizon,\n\t\t\tthis.loopLength,\n            );\n        \n        this.prevHorizon = horizon\n\n\t\tif (schedule.length > 0) {\n\t\t    this.emitSchedule(schedule)\n\t\t}\n\t}\n}\n","import { ILoopNote, Seconds, IScheduledNote } from './Scheduler';\nimport { IRange } from '@musicenviro/base';\nimport { windowPosition } from './windowPosition';\n\nexport function getNewScheduledNotes<T>(\n\tloop: ILoopNote<T>[],\n\tacTime: Seconds,\n\tlookAhead: Seconds,\n\tprevHorizon: Seconds,\n\tloopLength: Seconds,\n): {\n\tschedule: IScheduledNote<T>[];\n\thorizon: Seconds;\n} {\n\tconst win: IRange<Seconds> = {\n\t\tmin: Math.max(acTime, prevHorizon),\n\t\tmax: acTime + lookAhead,\n\t};\n\n\t// express range as number of loops\n\tconst rawPropWindow = { min: win.min / loopLength, max: win.max / loopLength };\n\n\t// translate range so that min falls between 0 and 1\n\tconst translation = (rawPropWindow.min % 1) - rawPropWindow.min;\n\tconst propWindow = {\n\t\tmin: rawPropWindow.min + translation,\n\t\tmax: rawPropWindow.max + translation,\n\t};\n\n\tconst schedule = loop\n\t\t.map((note) => {\n\t\t\tconst pos = windowPosition(note.loopTime, propWindow);\n\t\t\tif (!pos) return null;\n\t\t\treturn {\n\t\t\t\tdata: note.data,\n\t\t\t\taudioContextTime: (pos - translation) * loopLength,\n\t\t\t};\n\t\t})\n\t\t.filter(Boolean) as IScheduledNote<T>[];\n\n\treturn {\n\t\tschedule,\n\t\thorizon: win.max,\n\t};\n}\n\n\n","import { PropTime } from './Scheduler';\nimport { IRange } from '@musicenviro/base';\n/**\n *\n * @param loopTime\n * @param propWindow window expressed as prop time. if it spans the threshold, max will be greater than 1,\n *                      but min is always 0-1\n * @param loopLength\n */\nexport function windowPosition(loopTime: PropTime, propWindow: IRange<PropTime>): PropTime | null {\n    const offset = (loopTime - propWindow.min + 1) % 1;\n    if (offset > propWindow.max - propWindow.min)\n        return null;\n    if (loopTime < propWindow.min) {\n        return loopTime + 1;\n    }\n    else {\n        return loopTime;\n    }\n}\n","import React from 'react';\nimport './App.css';\n\nimport { MultiNoteLanes } from '@musicenviro/ui-elements';\nimport { kick, snare, hihat } from './drumSynth';\nimport { Scheduler, ILoopNote } from './Scheduler/Scheduler';\nimport { MessageClient } from '@geof/socket-messaging';\nimport { IMessage, INoteContent } from './@types';\nimport { IPoint } from '@musicenviro/base';\n\nimport Cursor from './resources/cursor_PNG99.png';\nimport { ReactFacebookLoginInfo } from 'react-facebook-login';\n\n// const testLoop = [\n// \t{ data: 1, loopTime: 0 },\n// \t{ data: 1, loopTime: 0.5 },\n// \t{ data: 1, loopTime: 0.875 },\n// ];\n\nconst nodeDropletIP = '167.172.3.7';\nconst local = false;\nconst serverURL = local ? 'ws://localhost:8080' : `ws://${nodeDropletIP}`;\n\ninterface IState {\n\totherMouse: IPoint;\n}\n\nclass App extends React.Component<{userInfo: ReactFacebookLoginInfo}, IState> {\n\t\n\tscheduler = new Scheduler<number>();\n\tac!: AudioContext;\n\tuser = 'user' + Math.floor(Math.random() * 10000);\n\tmultiLane = React.createRef<MultiNoteLanes>();\n\n\tsubLoops: ILoopNote<number>[][] = [[], [], [], []];\n\n\tclient = new MessageClient<IMessage>(serverURL);\n\n\tconstructor(props: {userInfo: ReactFacebookLoginInfo}) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\totherMouse: { x: -10, y: -10 },\n\t\t};\n\n\t\t// this.scheduler.setLoop(testLoop);\n\n\t\tthis.scheduler.onSchedule((notes) =>\n\t\t\tnotes.forEach((note) => {\n\t\t\t\tconst fn = [hihat, hihat, snare, kick][note.data];\n\t\t\t\tfn(this.ac, note.audioContextTime);\n\t\t\t}),\n\t\t);\n\n\t\tthis.client.onMessage((message) => this.handleServerMessage(message));\n\n\t\tthis.client.onConnected(() => {\n\t\t\tsetInterval(() => this.reportMousePosition(), 100);\n\t\t});\n\t}\n\n\tstartAudio() {\n\t\tif (this.ac) {\n\t\t\tthis.ac.resume();\n\t\t} else {\n\t\t\tthis.ac = new AudioContext();\n\t\t\tthis.scheduler.setAudioContext(this.ac);\n\t\t\tthis.scheduler.start();\n\t\t}\n\t}\n\n\tstopAudio() {\n\t\tthis.ac && this.ac.suspend();\n\t}\n\n\thandleNoteChange(instr: number, notes: number[], broadcast: boolean = true) {\n\t\tif (broadcast) {\n\t\t\tconst diff = getDiff(\n\t\t\t\tthis.subLoops[instr].map((note) => note.loopTime),\n\t\t\t\tnotes,\n\t\t\t);\n\n\t\t\tdiff.add.forEach((n) =>\n\t\t\t\tthis.client.send({\n\t\t\t\t\tuser: this.user,\n\t\t\t\t\ttype: 'NoteChange',\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\tsequence: 0, // not implemented\n\t\t\t\t\t\taction: 'Add',\n\t\t\t\t\t\tinstrument: instr,\n\t\t\t\t\t\tloopTime: n,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tdiff.delete.forEach((n) =>\n\t\t\t\tthis.client.send({\n\t\t\t\t\tuser: this.user,\n\t\t\t\t\ttype: 'NoteChange',\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\tsequence: 0, // not implemented\n\t\t\t\t\t\taction: 'Delete',\n\t\t\t\t\t\tinstrument: instr,\n\t\t\t\t\t\tloopTime: n,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tthis.subLoops[instr] = notes.map((note) => ({\n\t\t\tdata: instr,\n\t\t\tloopTime: note,\n\t\t}));\n\n\t\tthis.scheduler.setLoop(([] as ILoopNote[]).concat(...this.subLoops));\n\t}\n\n\thandleServerMessage(message: IMessage) {\n\t\tif (message.user !== this.user) {\n\t\t\tswitch (message.type) {\n\t\t\t\tcase 'MousePosition':\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\totherMouse: message.content,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'NoteChange':\n\t\t\t\t\tconst change = message.content as INoteContent;\n\n\t\t\t\t\tconst newLoopTimes = applyDiff(\n\t\t\t\t\t\tthis.subLoops[change.instrument].map((note) => note.loopTime),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tadd: change.action === 'Add' ? [change.loopTime] : [],\n\t\t\t\t\t\t\tdelete: change.action === 'Delete' ? [change.loopTime] : [],\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.multiLane.current?.setNotes(change.instrument, newLoopTimes);\n\n\t\t\t\t\tthis.subLoops[change.instrument] = newLoopTimes.map((loopTime) => ({\n\t\t\t\t\t\tdata: change.instrument,\n\t\t\t\t\t\tloopTime,\n\t\t\t\t\t}));\n\n\t\t\t\t\tthis.scheduler.setLoop(([] as ILoopNote[]).concat(...this.subLoops));\n\t\t\t\t\t\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t}\n\t\t}\n\t}\n\n\tmousePosition: IPoint = { x: -10, y: -10 };\n\n\treportMousePosition() {\n\t\tthis.client.send({\n\t\t\tuser: this.user,\n\t\t\ttype: 'MousePosition',\n\t\t\tcontent: this.mousePosition,\n\t\t});\n\t}\n\n\thandleMouseMove(event: React.MouseEvent) {\n\t\tthis.mousePosition = { x: event.clientX, y: event.clientY };\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"App\" onMouseMove={(event) => this.handleMouseMove(event)}>\n\t\t\t\t><header>sequence collab: welcome {this.props.userInfo.name}</header>\n\t\t\t\t<div id=\"main\">\n\t\t\t\t\t<MultiNoteLanes\n\t\t\t\t\t\tref={this.multiLane}\n\t\t\t\t\t\tonChange={(instr, notes) => {\n\t\t\t\t\t\t\tthis.handleNoteChange(instr, notes);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t\t<button onClick={() => this.startAudio()}>play</button>\n\t\t\t\t\t<button onClick={() => this.stopAudio()}>pause</button>\n\t\t\t\t</div>\n\t\t\t\t<img\n\t\t\t\t\tsrc={Cursor}\n\t\t\t\t\tid=\"otherguy\"\n\t\t\t\t\talt=\"\"\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\t// backgroundColor: 'blue',\n\t\t\t\t\t\topacity: 0.3,\n\t\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\t\tleft: this.state.otherMouse.x,\n\t\t\t\t\t\ttop: this.state.otherMouse.y,\n\t\t\t\t\t\theight: 20,\n\t\t\t\t\t\twidth: 20,\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default App;\n\nfunction getDiff(prev: number[], curr: number[]) {\n\tconst addedNotes = curr.filter((n) => !prev.includes(n));\n\tconst deletedNotes = prev.filter((n) => !curr.includes(n));\n\n\treturn {\n\t\tadd: addedNotes,\n\t\tdelete: deletedNotes,\n\t};\n}\n\nfunction applyDiff(orig: number[], diff: { add: number[]; delete: number[] }): number[] {\n\tlet copy = orig.slice();\n\tcopy.push(...diff.add);\n\tcopy = copy.filter((n) => !diff.delete.includes(n));\n\n\treturn copy;\n}\n","\nimport React from \"react\";\nimport FacebookLogin, { ReactFacebookLoginInfo } from \"react-facebook-login\";\nimport { appId } from \"../config\";\nimport \"./CodePen.css\"\n\nexport function FacebookLoginButton(props: {callback: (userInfo: ReactFacebookLoginInfo) => void}) {\n    return (<FacebookLogin\n        appId={appId}\n        autoLoad={false}\n        fields=\"name,email,picture\"\n        callback={props.callback}\n        cssClass=\"loginBtn loginBtn--facebook\"\n      />)\n}","export const appId = \"530431044551333\"","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport { ReactFacebookLoginInfo } from 'react-facebook-login';\nimport { FacebookLoginButton } from './users/LoginButton';\n\nlet userInfo: ReactFacebookLoginInfo | null = null;\n\nReactDOM.render(\n\t<div>\n\t\t<FacebookLoginButton\n\t\t\tcallback={(info: ReactFacebookLoginInfo) => {\n\t\t\t\tuserInfo = info;\n\t\t\t\tReactDOM.render(<App userInfo={userInfo} />, document.getElementById('root'));\n\t\t\t}}\n\t\t/>\n\t</div>,\n\tdocument.getElementById('root'),\n);\n"],"sourceRoot":""}