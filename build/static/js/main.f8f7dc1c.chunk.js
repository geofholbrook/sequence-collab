(this["webpackJsonpsequence-collab"]=this["webpackJsonpsequence-collab"]||[]).push([[0],{14:function(e,t,n){"use strict";t.__esModule=!0;var o=n(1),i=n(46),a=function(){function e(){this.loop=[],this.prevHorizon=0,this.emitter=new o.EventEmitter,this.loopLength=2}return e.prototype.setAudioContext=function(e){this.ac=e},e.prototype.setLoop=function(e){this.loop=e},e.prototype.start=function(){var e=this;this.timer||(this.timer=setInterval((function(){return e.iterate()}),25))},e.prototype.emitSchedule=function(e){this.emitter.emit("schedule",e)},e.prototype.onSchedule=function(e){this.emitter.on("schedule",e)},e.prototype.iterate=function(){var e=i.getNewScheduledNotes(this.loop,this.ac.currentTime,.1,this.prevHorizon,this.loopLength),t=e.schedule,n=e.horizon;this.prevHorizon=n,t.length>0&&this.emitSchedule(t)},e}();t.Scheduler=a},16:function(e,t,n){e.exports=n.p+"static/media/cursor_PNG99.be56600f.png"},19:function(e,t,n){e.exports=n(51)},24:function(e,t,n){},46:function(e,t,n){"use strict";t.__esModule=!0;var o=n(47);t.getNewScheduledNotes=function(e,t,n,i,a){var r={min:Math.max(t,i),max:t+n},s=r.min/a,u=s%1-s,c={min:s+u,max:r.max/a+u};return{schedule:e.map((function(e){var t=o.windowPosition(e.loopTime,c);return t?{data:e.data,audioContextTime:(t-u)*a}:null})).filter(Boolean),horizon:r.max}}},47:function(e,t,n){"use strict";t.__esModule=!0,t.windowPosition=function(e,t){return(e-t.min+1)%1>t.max-t.min?null:e<t.min?e+1:e}},51:function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o),a=n(10),r=n.n(a),s=n(3),u=n(11),c=n(12),l=n(17),h=n(18),p=(n(24),n(13));function d(e,t){var n=e.createOscillator(),o=e.createOscillator(),i=e.createGain(),a=e.createGain();n.type="triangle",o.type="sine",i.gain.setValueAtTime(1,t),i.gain.exponentialRampToValueAtTime(.001,t+.5),a.gain.setValueAtTime(1,t),a.gain.exponentialRampToValueAtTime(.001,t+.5),n.frequency.setValueAtTime(120,t),n.frequency.exponentialRampToValueAtTime(.001,t+.5),o.frequency.setValueAtTime(50,t),o.frequency.exponentialRampToValueAtTime(.001,t+.5),n.connect(i),o.connect(a),a.connect(e.destination),i.connect(e.destination),i.connect(e.destination),a.connect(e.destination),n.start(t),o.start(t),n.stop(t+.5),o.stop(t+.5)}function m(e,t){var n=e.createOscillator(),o=e.createGain(),i=e.createGain();i.gain.setValueAtTime(1,t),i.gain.exponentialRampToValueAtTime(.01,t+.2),n.type="triangle",n.frequency.value=100,o.gain.value=0,o.gain.setValueAtTime(0,t),o.gain.exponentialRampToValueAtTime(.01,t+.1),n.connect(o),o.connect(e.destination),n.start(t),n.stop(t+.2);var a=e.createBufferSource(),r=e.createBuffer(1,4096,e.sampleRate),s=r.getChannelData(0),u=e.createBiquadFilter();u.type="highpass",u.frequency.setValueAtTime(100,t),u.frequency.linearRampToValueAtTime(1e3,t+.2);for(var c=0;c<4096;c++)s[c]=Math.random();a.buffer=r,a.loop=!0,a.connect(u),u.connect(i),i.connect(e.destination),a.start(t),a.stop(t+.2)}function f(e,t){var n=e.createGain(),o=e.createBiquadFilter();o.type="bandpass",o.frequency.value=1e4;var i=e.createBiquadFilter();i.type="highpass",i.frequency.value=7e3,[2,3,4.16,5.43,6.79,8.21].forEach((function(n){var i=e.createOscillator();i.type="square",i.frequency.value=40*n,i.connect(o),i.start(t),i.stop(t+.05)})),n.gain.setValueAtTime(1,t),n.gain.exponentialRampToValueAtTime(.01,t+.05),o.connect(i),i.connect(n),n.connect(e.destination)}var v=n(14),y=n(15),g=n(16),T=n.n(g),A="ws://".concat("167.172.3.7","/ws"),M=function(e){Object(h.a)(n,e);var t=Object(l.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).scheduler=new v.Scheduler,o.ac=void 0,o.user="user"+Math.floor(1e4*Math.random()),o.multiLane=i.a.createRef(),o.subLoops=[[],[],[],[]],o.client=new y.MessageClient(A),o.mousePosition={x:-10,y:-10},o.state={otherMouse:{x:-10,y:-10}},o.scheduler.onSchedule((function(e){return e.forEach((function(e){(0,[f,f,m,d][e.data])(o.ac,e.audioContextTime)}))})),o.client.onMessage((function(e){return o.handleServerMessage(e)})),o.client.onConnected((function(){setInterval((function(){return o.reportMousePosition()}),100)})),o}return Object(c.a)(n,[{key:"startAudio",value:function(){this.ac?this.ac.resume():(this.ac=new AudioContext,this.scheduler.setAudioContext(this.ac),this.scheduler.start())}},{key:"stopAudio",value:function(){this.ac&&this.ac.suspend()}},{key:"handleNoteChange",value:function(e,t){var n,o=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(i){var a=b(this.subLoops[e].map((function(e){return e.loopTime})),t);a.add.forEach((function(t){return o.client.send({user:o.user,type:"NoteChange",content:{sequence:0,action:"Add",instrument:e,loopTime:t}})})),a.delete.forEach((function(t){return o.client.send({user:o.user,type:"NoteChange",content:{sequence:0,action:"Delete",instrument:e,loopTime:t}})}))}this.subLoops[e]=t.map((function(t){return{data:e,loopTime:t}})),this.scheduler.setLoop((n=[]).concat.apply(n,Object(s.a)(this.subLoops)))}},{key:"handleServerMessage",value:function(e){var t,n;if(e.user!==this.user)switch(e.type){case"MousePosition":this.setState({otherMouse:e.content});break;case"NoteChange":var o=e.content,i=function(e,t){var n,o=e.slice();return(n=o).push.apply(n,Object(s.a)(t.add)),o=o.filter((function(e){return!t.delete.includes(e)}))}(this.subLoops[o.instrument].map((function(e){return e.loopTime})),{add:"Add"===o.action?[o.loopTime]:[],delete:"Delete"===o.action?[o.loopTime]:[]});null===(t=this.multiLane.current)||void 0===t||t.setNotes(o.instrument,i),this.subLoops[o.instrument]=i.map((function(e){return{data:o.instrument,loopTime:e}})),this.scheduler.setLoop((n=[]).concat.apply(n,Object(s.a)(this.subLoops)))}}},{key:"reportMousePosition",value:function(){this.client.send({user:this.user,type:"MousePosition",content:this.mousePosition})}},{key:"handleMouseMove",value:function(e){this.mousePosition={x:e.clientX,y:e.clientY}}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App",onMouseMove:function(t){return e.handleMouseMove(t)}},">",i.a.createElement("header",null,"SYNCROJAM ",this.props.userInfo.name),i.a.createElement("div",{id:"main"},i.a.createElement(p.MultiNoteLanes,{ref:this.multiLane,onChange:function(t,n){e.handleNoteChange(t,n)}}),i.a.createElement("button",{onClick:function(){return e.startAudio()}},"play"),i.a.createElement("button",{onClick:function(){return e.stopAudio()}},"pause")),i.a.createElement("img",{src:T.a,id:"otherguy",alt:"",style:{opacity:.3,position:"fixed",left:this.state.otherMouse.x,top:this.state.otherMouse.y,height:20,width:20}}))}}]),n}(i.a.Component);function b(e,t){return{add:t.filter((function(t){return!e.includes(t)})),delete:e.filter((function(e){return!t.includes(e)}))}}r.a.render(i.a.createElement(M,{userInfo:{name:"<login disabled>"}}),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.f8f7dc1c.chunk.js.map