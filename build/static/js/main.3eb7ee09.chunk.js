(this["webpackJsonpsequence-collab"]=this["webpackJsonpsequence-collab"]||[]).push([[0],{15:function(e,t,n){e.exports=n.p+"static/media/cursor_PNG99.be56600f.png"},19:function(e,t,n){e.exports=n(50)},24:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(8),r=n.n(o),u=n(5),c=n(3),s=n(4),l=n(17),h=n(18),m=(n(24),n(13));function p(e,t){var n=e.createOscillator(),a=e.createOscillator(),i=e.createGain(),o=e.createGain();n.type="triangle",a.type="sine",i.gain.setValueAtTime(1,t),i.gain.exponentialRampToValueAtTime(.001,t+.5),o.gain.setValueAtTime(1,t),o.gain.exponentialRampToValueAtTime(.001,t+.5),n.frequency.setValueAtTime(120,t),n.frequency.exponentialRampToValueAtTime(.001,t+.5),a.frequency.setValueAtTime(50,t),a.frequency.exponentialRampToValueAtTime(.001,t+.5),n.connect(i),a.connect(o),o.connect(e.destination),i.connect(e.destination),i.connect(e.destination),o.connect(e.destination),n.start(t),a.start(t),n.stop(t+.5),a.stop(t+.5)}function d(e,t){var n=e.createOscillator(),a=e.createGain(),i=e.createGain();i.gain.setValueAtTime(1,t),i.gain.exponentialRampToValueAtTime(.01,t+.2),n.type="triangle",n.frequency.value=100,a.gain.value=0,a.gain.setValueAtTime(0,t),a.gain.exponentialRampToValueAtTime(.01,t+.1),n.connect(a),a.connect(e.destination),n.start(t),n.stop(t+.2);var o=e.createBufferSource(),r=e.createBuffer(1,4096,e.sampleRate),u=r.getChannelData(0),c=e.createBiquadFilter();c.type="highpass",c.frequency.setValueAtTime(100,t),c.frequency.linearRampToValueAtTime(1e3,t+.2);for(var s=0;s<4096;s++)u[s]=Math.random();o.buffer=r,o.loop=!0,o.connect(c),c.connect(i),i.connect(e.destination),o.start(t),o.stop(t+.2)}function f(e,t){var n=e.createGain(),a=e.createBiquadFilter();a.type="bandpass",a.frequency.value=1e4;var i=e.createBiquadFilter();i.type="highpass",i.frequency.value=7e3,[2,3,4.16,5.43,6.79,8.21].forEach((function(n){var i=e.createOscillator();i.type="square",i.frequency.value=40*n,i.connect(a),i.start(t),i.stop(t+.05)})),n.gain.setValueAtTime(1,t),n.gain.exponentialRampToValueAtTime(.01,t+.05),a.connect(i),i.connect(n),n.connect(e.destination)}var v=n(1);var y=function(){function e(){Object(c.a)(this,e),this.ac=void 0,this.timer=void 0,this.loop=[],this.prevHorizon=0,this.emitter=new v.EventEmitter,this.loopLength=2}return Object(s.a)(e,[{key:"setAudioContext",value:function(e){this.ac=e}},{key:"setLoop",value:function(e){this.loop=e}},{key:"start",value:function(){var e=this;this.timer||(this.timer=setInterval((function(){return e.iterate()}),25))}},{key:"emitSchedule",value:function(e){this.emitter.emit("schedule",e)}},{key:"onSchedule",value:function(e){this.emitter.on("schedule",e)}},{key:"iterate",value:function(){var e=function(e,t,n,a,i){var o={min:Math.max(t,a),max:t+n},r=o.min/i,u=r%1-r,c={min:r+u,max:o.max/i+u};return{schedule:e.map((function(e){var t=function(e,t){return(e-t.min+1)%1>t.max-t.min?null:e<t.min?e+1:e}(e.loopTime,c);return t?{data:e.data,audioContextTime:(t-u)*i}:null})).filter(Boolean),horizon:o.max}}(this.loop,this.ac.currentTime,.1,this.prevHorizon,this.loopLength),t=e.schedule,n=e.horizon;this.prevHorizon=n,t.length>0&&this.emitSchedule(t)}}]),e}(),g=n(14),T=n(15),b=n.n(T),A="ws://".concat("167.172.3.7"),x=function(e){Object(h.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).scheduler=new y,a.ac=void 0,a.user="user"+Math.floor(1e4*Math.random()),a.multiLane=i.a.createRef(),a.subLoops=[[],[],[],[]],a.client=new g.MessageClient(A),a.mousePosition={x:-10,y:-10},a.state={otherMouse:{x:-10,y:-10}},a.scheduler.onSchedule((function(e){return e.forEach((function(e){(0,[f,f,d,p][e.data])(a.ac,e.audioContextTime)}))})),a.client.onMessage((function(e){return a.handleServerMessage(e)})),a.client.onConnected((function(){setInterval((function(){return a.reportMousePosition()}),100)})),a}return Object(s.a)(n,[{key:"startAudio",value:function(){this.ac?this.ac.resume():(this.ac=new AudioContext,this.scheduler.setAudioContext(this.ac),this.scheduler.start())}},{key:"stopAudio",value:function(){this.ac&&this.ac.suspend()}},{key:"handleNoteChange",value:function(e,t){var n,a=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(i){var o=M(this.subLoops[e].map((function(e){return e.loopTime})),t);o.add.forEach((function(t){return a.client.send({user:a.user,type:"NoteChange",content:{sequence:0,action:"Add",instrument:e,loopTime:t}})})),o.delete.forEach((function(t){return a.client.send({user:a.user,type:"NoteChange",content:{sequence:0,action:"Delete",instrument:e,loopTime:t}})}))}this.subLoops[e]=t.map((function(t){return{data:e,loopTime:t}})),this.scheduler.setLoop((n=[]).concat.apply(n,Object(u.a)(this.subLoops)))}},{key:"handleServerMessage",value:function(e){var t,n;if(e.user!==this.user)switch(e.type){case"MousePosition":this.setState({otherMouse:e.content});break;case"NoteChange":var a=e.content,i=function(e,t){var n,a=e.slice();return(n=a).push.apply(n,Object(u.a)(t.add)),a=a.filter((function(e){return!t.delete.includes(e)}))}(this.subLoops[a.instrument].map((function(e){return e.loopTime})),{add:"Add"===a.action?[a.loopTime]:[],delete:"Delete"===a.action?[a.loopTime]:[]});null===(t=this.multiLane.current)||void 0===t||t.setNotes(a.instrument,i),this.subLoops[a.instrument]=i.map((function(e){return{data:a.instrument,loopTime:e}})),this.scheduler.setLoop((n=[]).concat.apply(n,Object(u.a)(this.subLoops)))}}},{key:"reportMousePosition",value:function(){this.client.send({user:this.user,type:"MousePosition",content:this.mousePosition})}},{key:"handleMouseMove",value:function(e){this.mousePosition={x:e.clientX,y:e.clientY}}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App",onMouseMove:function(t){return e.handleMouseMove(t)}},">",i.a.createElement("header",null,"sequence collab: welcome ",this.props.userInfo.name),i.a.createElement("div",{id:"main"},i.a.createElement(m.MultiNoteLanes,{ref:this.multiLane,onChange:function(t,n){e.handleNoteChange(t,n)}}),i.a.createElement("button",{onClick:function(){return e.startAudio()}},"play"),i.a.createElement("button",{onClick:function(){return e.stopAudio()}},"pause")),i.a.createElement("img",{src:b.a,id:"otherguy",alt:"",style:{opacity:.3,position:"fixed",left:this.state.otherMouse.x,top:this.state.otherMouse.y,height:20,width:20}}))}}]),n}(i.a.Component);function M(e,t){return{add:t.filter((function(t){return!e.includes(t)})),delete:e.filter((function(e){return!t.includes(e)}))}}var k=n(16),q=n.n(k);n(49);function E(e){return i.a.createElement(q.a,{appId:"530431044551333",autoLoad:!1,fields:"name,email,picture",callback:e.callback,cssClass:"loginBtn loginBtn--facebook"})}var C=null;r.a.render(i.a.createElement("div",null,i.a.createElement(E,{callback:function(e){C=e,r.a.render(i.a.createElement(x,{userInfo:C}),document.getElementById("root"))}})),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.3eb7ee09.chunk.js.map