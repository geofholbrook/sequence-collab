(this["webpackJsonpsequence-collab"]=this["webpackJsonpsequence-collab"]||[]).push([[0],{15:function(e,t,n){e.exports=n.p+"static/media/cursor_PNG99.be56600f.png"},18:function(e,t,n){e.exports=n(48)},23:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),a=n(12),u=n.n(a),r=n(5),s=n(3),c=n(4),l=n(16),h=n(17),p=(n(23),n(13));function m(e,t){var n=e.createOscillator(),i=e.createOscillator(),o=e.createGain(),a=e.createGain();n.type="triangle",i.type="sine",o.gain.setValueAtTime(1,t),o.gain.exponentialRampToValueAtTime(.001,t+.5),a.gain.setValueAtTime(1,t),a.gain.exponentialRampToValueAtTime(.001,t+.5),n.frequency.setValueAtTime(120,t),n.frequency.exponentialRampToValueAtTime(.001,t+.5),i.frequency.setValueAtTime(50,t),i.frequency.exponentialRampToValueAtTime(.001,t+.5),n.connect(o),i.connect(a),a.connect(e.destination),o.connect(e.destination),o.connect(e.destination),a.connect(e.destination),n.start(t),i.start(t),n.stop(t+.5),i.stop(t+.5)}function d(e,t){var n=e.createOscillator(),i=e.createGain(),o=e.createGain();o.gain.setValueAtTime(1,t),o.gain.exponentialRampToValueAtTime(.01,t+.2),n.type="triangle",n.frequency.value=100,i.gain.value=0,i.gain.setValueAtTime(0,t),i.gain.exponentialRampToValueAtTime(.01,t+.1),n.connect(i),i.connect(e.destination),n.start(t),n.stop(t+.2);var a=e.createBufferSource(),u=e.createBuffer(1,4096,e.sampleRate),r=u.getChannelData(0),s=e.createBiquadFilter();s.type="highpass",s.frequency.setValueAtTime(100,t),s.frequency.linearRampToValueAtTime(1e3,t+.2);for(var c=0;c<4096;c++)r[c]=Math.random();a.buffer=u,a.loop=!0,a.connect(s),s.connect(o),o.connect(e.destination),a.start(t),a.stop(t+.2)}function f(e,t){var n=e.createGain(),i=e.createBiquadFilter();i.type="bandpass",i.frequency.value=1e4;var o=e.createBiquadFilter();o.type="highpass",o.frequency.value=7e3,[2,3,4.16,5.43,6.79,8.21].forEach((function(n){var o=e.createOscillator();o.type="square",o.frequency.value=40*n,o.connect(i),o.start(t),o.stop(t+.05)})),n.gain.setValueAtTime(1,t),n.gain.exponentialRampToValueAtTime(.01,t+.05),i.connect(o),o.connect(n),n.connect(e.destination)}var v=n(1);var y=function(){function e(){Object(s.a)(this,e),this.ac=void 0,this.timer=void 0,this.loop=[],this.prevHorizon=0,this.emitter=new v.EventEmitter,this.loopLength=2}return Object(c.a)(e,[{key:"setAudioContext",value:function(e){this.ac=e}},{key:"setLoop",value:function(e){this.loop=e}},{key:"start",value:function(){var e=this;this.timer||(this.timer=setInterval((function(){return e.iterate()}),25))}},{key:"emitSchedule",value:function(e){this.emitter.emit("schedule",e)}},{key:"onSchedule",value:function(e){this.emitter.on("schedule",e)}},{key:"iterate",value:function(){var e=function(e,t,n,i,o){var a={min:Math.max(t,i),max:t+n},u=a.min/o,r=u%1-u,s={min:u+r,max:a.max/o+r};return{schedule:e.map((function(e){var t=function(e,t){return(e-t.min+1)%1>t.max-t.min?null:e<t.min?e+1:e}(e.loopTime,s);return t?{data:e.data,audioContextTime:(t-r)*o}:null})).filter(Boolean),horizon:a.max}}(this.loop,this.ac.currentTime,.1,this.prevHorizon,this.loopLength),t=e.schedule,n=e.horizon;this.prevHorizon=n,t.length>0&&this.emitSchedule(t)}}]),e}(),T=n(14),g=n(15),b=n.n(g),A="ws://".concat("167.172.3.7"),x=function(e){Object(h.a)(n,e);var t=Object(l.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).scheduler=new y,i.ac=void 0,i.user="user"+Math.floor(1e4*Math.random()),i.multiLane=o.a.createRef(),i.subLoops=[[],[],[],[]],i.client=new T.MessageClient(A),i.mousePosition={x:-10,y:-10},i.state={otherMouse:{x:-10,y:-10}},i.scheduler.onSchedule((function(e){return e.forEach((function(e){(0,[f,f,d,m][e.data])(i.ac,e.audioContextTime)}))})),i.client.onMessage((function(e){return i.handleServerMessage(e)})),i.client.onConnected((function(){setInterval((function(){return i.reportMousePosition()}),100)})),i}return Object(c.a)(n,[{key:"startAudio",value:function(){this.ac?this.ac.resume():(this.ac=new AudioContext,this.scheduler.setAudioContext(this.ac),this.scheduler.start())}},{key:"stopAudio",value:function(){this.ac&&this.ac.suspend()}},{key:"handleNoteChange",value:function(e,t){var n,i=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(o){var a=M(this.subLoops[e].map((function(e){return e.loopTime})),t);a.add.forEach((function(t){return i.client.send({user:i.user,type:"NoteChange",content:{sequence:0,action:"Add",instrument:e,loopTime:t}})})),a.delete.forEach((function(t){return i.client.send({user:i.user,type:"NoteChange",content:{sequence:0,action:"Delete",instrument:e,loopTime:t}})}))}this.subLoops[e]=t.map((function(t){return{data:e,loopTime:t}})),this.scheduler.setLoop((n=[]).concat.apply(n,Object(r.a)(this.subLoops)))}},{key:"handleServerMessage",value:function(e){var t,n;if(e.user!==this.user)switch(e.type){case"MousePosition":this.setState({otherMouse:e.content});break;case"NoteChange":var i=e.content,o=function(e,t){var n,i=e.slice();return(n=i).push.apply(n,Object(r.a)(t.add)),i=i.filter((function(e){return!t.delete.includes(e)}))}(this.subLoops[i.instrument].map((function(e){return e.loopTime})),{add:"Add"===i.action?[i.loopTime]:[],delete:"Delete"===i.action?[i.loopTime]:[]});null===(t=this.multiLane.current)||void 0===t||t.setNotes(i.instrument,o),this.subLoops[i.instrument]=o.map((function(e){return{data:i.instrument,loopTime:e}})),this.scheduler.setLoop((n=[]).concat.apply(n,Object(r.a)(this.subLoops)))}}},{key:"reportMousePosition",value:function(){this.client.send({user:this.user,type:"MousePosition",content:this.mousePosition})}},{key:"handleMouseMove",value:function(e){this.mousePosition={x:e.clientX,y:e.clientY}}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"App",onMouseMove:function(t){return e.handleMouseMove(t)}},">",o.a.createElement("header",null,"sequence collab"),o.a.createElement("div",{id:"main"},o.a.createElement(p.MultiNoteLanes,{ref:this.multiLane,onChange:function(t,n){e.handleNoteChange(t,n)}}),o.a.createElement("button",{onClick:function(){return e.startAudio()}},"play"),o.a.createElement("button",{onClick:function(){return e.stopAudio()}},"pause")),o.a.createElement("img",{src:b.a,id:"otherguy",alt:"",style:{opacity:.3,position:"fixed",left:this.state.otherMouse.x,top:this.state.otherMouse.y,height:20,width:20}}))}}]),n}(o.a.Component);function M(e,t){return{add:t.filter((function(t){return!e.includes(t)})),delete:e.filter((function(e){return!t.includes(e)}))}}u.a.render(o.a.createElement(x,null),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.f18d5907.chunk.js.map